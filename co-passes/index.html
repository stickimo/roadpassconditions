<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CO Pass Conditions | Colorado Mountain Pass Weather & Status</title>
    <meta name="description" content="Colorado mountain pass conditions with live National Weather Service data." />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <h1>RoadPassConditions.com</h1>
      <p>Fast mountain pass snapshot built for travelers and dispatchers.</p>
    </header>
    <main>
      <div class="state-head">
        <section class="hero">
          <h2>Pass Overview</h2>
          <p>Updated from official weather sources. Select a state for pass details.</p>
        </section>
        <div class="pass-controls-wrap">
          <div class="pass-controls">
            <div class="pass-search">
              <label for="pass-search">Find a pass</label>
              <input id="pass-search" type="search" placeholder="Search passes..." autocomplete="off" />
              <ul id="pass-search-results" class="pass-search-results" hidden></ul>
            </div>
          </div>
        </div>
      </div>
      <section>
        <h2>States</h2>
        <ul class="pass-list" id="state-list"></ul>
      </section>
    </main>
    <footer class="site-footer">
      <p>&copy; <span id="year"></span> RoadPassConditions.com. Built with live National Weather Service data.</p>
      <p><a href="about.html">About</a> • <a href="privacy.html">Privacy</a> • <a href="contact.html">Contact</a></p>
    </footer>
    <script type="module">
      import { onReady } from './assets/app.js';
      import { getPasses, getPassesByState, getStates, getStateLabel } from './assets/passes.js';

      onReady(() => {
        document.getElementById('year').textContent = new Date().getFullYear();
        const list = document.getElementById('state-list');
        const searchInput = document.getElementById('pass-search');
        const searchResults = document.getElementById('pass-search-results');
        const states = getStates();
        const allPasses = getPasses().sort((a, b) => a.name.localeCompare(b.name));
        const searchablePasses = allPasses.map((pass) => ({
          pass,
          search: `${pass.name} ${pass.route_label}`.toLowerCase(),
        }));
        let topMatchId = null;
        list.innerHTML = '';
        states.forEach((state) => {
          const passes = getPassesByState(state);
          const item = document.createElement('li');
          item.className = 'pass-card';
          const stateLabel = getStateLabel(state);
          const passCount = passes.length;
          item.innerHTML = `
            <h3>${stateLabel}</h3>
            <p>${passCount} passes tracked</p>
            <a href="state.html?state=${state}">View passes</a>
          `;
          list.appendChild(item);
        });

        function renderResults(matches) {
          if (!searchResults) return;
          searchResults.innerHTML = '';
          if (!matches.length) {
            searchResults.hidden = true;
            topMatchId = null;
            return;
          }
          matches.forEach(({ pass }) => {
            const item = document.createElement('li');
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'pass-search-result';
            button.dataset.passId = pass.id;

            const name = document.createElement('span');
            name.className = 'pass-result-name';
            name.textContent = pass.name;

            const meta = document.createElement('span');
            meta.className = 'pass-result-meta';
            meta.textContent = ` (${pass.state})${pass.route_label ? ` • ${pass.route_label}` : ''}`;

            button.appendChild(name);
            button.appendChild(meta);
            item.appendChild(button);
            searchResults.appendChild(item);
          });
          topMatchId = matches[0].pass.id;
          searchResults.hidden = false;
        }

        if (searchResults) {
          searchResults.addEventListener('click', (event) => {
            const button = event.target.closest('button[data-pass-id]');
            if (!button) return;
            const passId = button.dataset.passId;
            window.location.href = `pass.html?pass=${encodeURIComponent(passId)}`;
          });
        }

        if (searchInput) {
          searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            if (!query) {
              renderResults([]);
              return;
            }
            const matches = searchablePasses.filter(({ search }) => search.includes(query)).slice(0, 12);
            renderResults(matches);
          });
          searchInput.addEventListener('keydown', (event) => {
            if (event.key !== 'Enter') return;
            if (!topMatchId) return;
            window.location.href = `pass.html?pass=${encodeURIComponent(topMatchId)}`;
          });
        }
      });
    </script>
  </body>
</html>
